<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="description" content="Interactive WebAR game with plant detection and environmental data visualization">
  <meta name="theme-color" content="#0a0a0a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <title>pLaNt ExPlorEr</title>

  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Mono:ital,wght@0,400;0,700;1,400;1,700&family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&display=swap"
    rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="/styles.css">

  <!-- Import Map for ES Modules -->
  <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
      }
    }
  </script>

  <!-- MediaPipe Dependencies (loaded before modules) -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

  <!-- TensorFlow.js for plant segmentation -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/deeplab@0.2.1/dist/deeplab.min.js"></script>
</head>

<body>
  <!-- AR Container -->
  <div id="ar-container">
    <video id="camera-feed" autoplay playsinline></video>
    <canvas id="ar-canvas"></canvas>
  </div>

  <!-- UI Overlay -->
  <div id="ui-overlay">
    <!-- Status Indicator (no header) -->
    <div class="status-indicator" id="status-indicator">
      <span class="status-dot"></span>
      <span class="status-text">Initializing...</span>
    </div>

    <!-- Instructions Panel -->
    <div class="instructions-panel" id="instructions-panel">
      <div class="panel-content">
        <h2>How to Play</h2>
        <div class="instruction-item">
          <span class="material-symbols-outlined instruction-icon">photo_camera</span>
          <p><strong>Point at a plant</strong> to identify it</p>
        </div>
        <div class="instruction-item">
          <span class="material-symbols-outlined instruction-icon">pinch</span>
          <p><strong>Pinch</strong> to create environmental orb</p>
        </div>
        <div class="instruction-item">
          <span class="material-symbols-outlined instruction-icon">pan_tool</span>
          <p><strong>Open hand</strong> to attach orbs to wrist or create pendant</p>
        </div>
        <div class="demo-mode-toggle">
          <label class="toggle-label">
            <input type="checkbox" id="demo-mode-checkbox">
            <span class="toggle-slider"></span>
            <span class="toggle-text">Demo Mode (No API quota used)</span>
          </label>
        </div>
        <button class="btn-primary" id="start-btn">Start AR Experience</button>
      </div>
    </div>

    <!-- Plant Info Panel -->
    <div class="plant-info-panel hidden" id="plant-info-panel">
      <div class="panel-header">
        <h3>Plant Detected</h3>
        <button class="btn-close" id="close-plant-info">√ó</button>
      </div>
      <div class="plant-info-content" id="plant-info-content">
        <!-- Dynamically populated -->
      </div>
    </div>

    <!-- Environmental Data Panel -->
    <div class="env-data-panel hidden" id="env-data-panel">
      <div class="env-data-item">
        <span class="env-icon">üå°Ô∏è</span>
        <div class="env-data-text">
          <span class="env-label">Temperature</span>
          <span class="env-value" id="temp-value">--¬∞C</span>
        </div>
      </div>
      <div class="env-data-item">
        <span class="env-icon">üå§Ô∏è</span>
        <div class="env-data-text">
          <span class="env-label">Weather</span>
          <span class="env-value" id="weather-value">--</span>
        </div>
      </div>
      <div class="env-data-item">
        <span class="env-icon">üí®</span>
        <div class="env-data-text">
          <span class="env-label">Air Quality</span>
          <span class="env-value" id="aqi-value">--</span>
        </div>
      </div>
    </div>

    <!-- Controls -->
    <div class="controls-panel" id="controls-panel">
      <button class="control-btn" id="detect-plant-btn" title="Detect Plant">
        <span class="material-symbols-outlined">photo_camera</span>
      </button>
      <button class="control-btn" id="create-orb-btn" title="Create Orb">
        <span class="material-symbols-outlined">bubble_chart</span>
      </button>
      <button class="control-btn" id="create-pendant-btn" title="Create Pendant" disabled>
        <span class="material-symbols-outlined">diamond</span>
      </button>
    </div>

    <!-- Loading Spinner -->
    <div class="loading-spinner hidden" id="loading-spinner">
      <div class="spinner"></div>
      <p class="loading-text">Processing...</p>
    </div>
  </div>

  <!-- Configuration -->
  <script type="module" src="/config.js"></script>

  <!-- JavaScript Modules -->
  <script type="module" src="/js/main.js"></script>
</body>

</html>